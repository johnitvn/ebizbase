echo "Running pre-commit hook..."


# Block direct commit to 'dev' or 'main' branch
while read local_ref local_sha remote_ref remote_sha
do
  branch_name=$(echo $remote_ref | sed 's|refs/heads/||')
done
if [[ "$branch_name" == "dev" || "$branch_name" == "main" ]]; then
  echo "Pushing directly to 'dev' or 'main' branch is not allowed."
  exit 1
fi

echo "Running check targets with affected projects..."
npx nx affected --base=dev -t lint* --fix --outputStyle static
echo "Formating all change files..."
npx lint-staged --relative
